<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Butterfly Journal - Daily Entries & Mood Tracking</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Georgia", serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        color: #2c3e50;
        line-height: 1.6;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        background: rgba(255, 255, 255, 0.9);
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .header h1 {
        font-size: 2.5rem;
        color: #8b5a8c;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }

      .header p {
        font-size: 1.1rem;
        color: #6c757d;
        font-style: italic;
      }

      .pixel-butterfly-icon {
        width: 32px;
        height: 32px;
        image-rendering: pixelated;
        vertical-align: middle;
      }

      .pixel-butterfly-icon.inline {
        margin-right: 10px;
      }

      .pixel-butterfly-icon.small {
        width: 22px;
        height: 22px;
      }

      .journal-interface {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
        color: #8b5a8c;
        font-weight: bold;
        margin-bottom: 15px;
        transition: transform 0.2s ease, color 0.2s ease;
      }

      .back-link:hover {
        color: #a86fa8;
        transform: translateX(-3px);
      }

      .sidebar {
        background: rgba(255, 255, 255, 0.95);
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        height: fit-content;
      }

      .main-content {
        background: rgba(255, 255, 255, 0.95);
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      }

      .mood-tracker {
        margin-bottom: 25px;
      }

      .mood-tracker h3 {
        color: #8b5a8c;
        margin-bottom: 15px;
        font-size: 1.3rem;
      }

      .mood-options {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-bottom: 15px;
      }

      .mood-btn {
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 10px;
        background: white;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        font-size: 1.2rem;
      }

      .mood-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .mood-btn.active {
        border-color: #8b5a8c;
        background: #f0e6f1;
        transform: scale(1.05);
      }

      .journal-form h3 {
        color: #8b5a8c;
        margin-bottom: 20px;
        font-size: 1.3rem;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #495057;
      }

      .label-with-icon {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #8b5a8c;
      }

      .form-group textarea {
        resize: vertical;
        min-height: 120px;
      }

      .btn {
        background: linear-gradient(45deg, #8b5a8c, #a86fa8);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 25px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-right: 10px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(139, 90, 140, 0.4);
      }

      .btn-secondary {
        background: linear-gradient(45deg, #6c757d, #868e96);
      }

      .entries-list {
        margin-top: 30px;
      }

      .entries-list h3 {
        color: #8b5a8c;
        margin-bottom: 20px;
        font-size: 1.3rem;
      }

      .entry-card {
        background: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 15px;
        border-left: 4px solid #8b5a8c;
        transition: all 0.3s ease;
      }

      .entry-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      }

      .entry-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .entry-date {
        font-weight: bold;
        color: #8b5a8c;
      }

      .entry-mood {
        font-size: 1.5rem;
      }

      .entry-title {
        font-weight: bold;
        color: #495057;
        margin-bottom: 8px;
      }

      .entry-content {
        color: #6c757d;
        margin-bottom: 10px;
      }

      .entry-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
      }

      .tag {
        background: #e9ecef;
        color: #495057;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
      }

      .stats-panel {
        background: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
      }

      .stats-panel h4 {
        color: #8b5a8c;
        margin-bottom: 15px;
      }

      .stat-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
      }

      .search-filter {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .search-filter input,
      .search-filter select {
        flex: 1;
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 8px;
      }

      .butterfly-decoration {
        position: absolute;
        width: 70px;
        height: 70px;
        opacity: 0.5;
        animation: float 6s ease-in-out infinite;
        pointer-events: none;
        display: block;
        object-fit: contain;
        image-rendering: pixelated;
      }

      .butterfly-1 {
        top: 10%;
        left: 5%;
        animation-delay: 0s;
      }

      .butterfly-2 {
        top: 20%;
        right: 5%;
        animation-delay: 2s;
      }

      .butterfly-3 {
        bottom: 20%;
        left: 10%;
        animation-delay: 4s;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px) rotate(0deg);
        }
        25% {
          transform: translateY(-20px) rotate(5deg);
        }
        50% {
          transform: translateY(-10px) rotate(-5deg);
        }
        75% {
          transform: translateY(-15px) rotate(3deg);
        }
      }

      .butterfly-thought {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 10px 0;
        color: #8b5a8c;
        font-style: italic;
      }

      @media (max-width: 768px) {
        .journal-interface {
          grid-template-columns: 1fr;
        }

        .mood-options {
          grid-template-columns: repeat(2, 1fr);
        }

        .header h1 {
          font-size: 2rem;
        }
      }
    </style>
  </head>
  <body>
    <img
      src="../assets/Butterfly1.png"
      alt=""
      aria-hidden="true"
      class="butterfly-decoration butterfly-1"
    />
    <img
      src="../assets/Butterfly2.png"
      alt=""
      aria-hidden="true"
      class="butterfly-decoration butterfly-2"
    />
    <img
      src="../assets/Butterfly3.png"
      alt=""
      aria-hidden="true"
      class="butterfly-decoration butterfly-3"
    />

    <div class="container">
      <a href="../hub.html" class="back-link">
        <img
          src="../assets/Butterfly9.png"
          alt=""
          class="pixel-butterfly-icon small"
          aria-hidden="true"
        />
        Back to Hub
      </a>
      <div class="header">
        <h1>
          <img
            src="../assets/Butterfly4.png"
            alt=""
            class="pixel-butterfly-icon inline"
            aria-hidden="true"
          />
          Butterfly Journal
        </h1>
        <p>
          "Just as a butterfly transforms, so do you. Document your journey of
          growth and self-discovery."
        </p>
      </div>

      <div class="journal-interface">
        <div class="sidebar">
          <div class="mood-tracker">
            <h3>How are you feeling today?</h3>
            <div class="mood-options">
              <div class="mood-btn" data-mood="happy" title="Happy">üòä</div>
              <div class="mood-btn" data-mood="excited" title="Excited">ü§ó</div>
              <div class="mood-btn" data-mood="grateful" title="Grateful">
                üôè
              </div>
              <div class="mood-btn" data-mood="calm" title="Calm">üòå</div>
              <div class="mood-btn" data-mood="thinking" title="Thinking">
                ü§î
              </div>
              <div class="mood-btn" data-mood="tired" title="Tired">üò¥</div>
              <div class="mood-btn" data-mood="anxious" title="Anxious">üò∞</div>
              <div class="mood-btn" data-mood="sad" title="Sad">üò¢</div>
              <div class="mood-btn" data-mood="angry" title="Angry">üò†</div>
            </div>
          </div>

          <div class="stats-panel">
            <h4>üìä Your Journey Stats</h4>
            <div class="stat-item">
              <span>Total Entries:</span>
              <span id="totalEntries">0</span>
            </div>
            <div class="stat-item">
              <span>Current Streak:</span>
              <span id="currentStreak">0 days</span>
            </div>
            <div class="stat-item">
              <span>Most Common Mood:</span>
              <span id="commonMood">-</span>
            </div>
            <div class="stat-item">
              <span>This Month:</span>
              <span id="monthEntries">0 entries</span>
            </div>
          </div>
        </div>

        <div class="main-content">
          <div class="journal-form">
            <h3>‚úçÔ∏è Write Your Story</h3>
            <form id="journalForm">
              <div class="form-group">
                <label for="entryTitle">Title (optional)</label>
                <input
                  type="text"
                  id="entryTitle"
                  placeholder="Give your entry a title..."
                />
              </div>

              <div class="form-group">
                <label for="entryContent">What's on your mind?</label>
                <textarea
                  id="entryContent"
                  placeholder="Share your thoughts, feelings, and experiences today..."
                  required
                ></textarea>
              </div>

              <div class="form-group">
                <label for="butterflyThought" class="label-with-icon">
                  <img
                    src="../assets/Butterfly8.png"
                    alt=""
                    class="pixel-butterfly-icon small"
                    aria-hidden="true"
                  />
                  Butterfly Thought of the Day
                </label>
                <select id="butterflyThought">
                  <option value="">
                    Choose a thought that resonates with you...
                  </option>
                  <option value="transformation">
                    Transformation: "Change is beautiful, even when it's
                    uncomfortable"
                  </option>
                  <option value="patience">
                    üå± Patience: "Growth takes time, trust the process"
                  </option>
                  <option value="resilience">
                    üí™ Resilience: "You are stronger than you know"
                  </option>
                  <option value="hope">
                    üåü Hope: "Every day is a chance to begin again"
                  </option>
                  <option value="selflove">
                    ‚ù§Ô∏è Self-Love: "You deserve the love you give to others"
                  </option>
                  <option value="courage">
                    ü¶Å Courage: "Be brave enough to be yourself"
                  </option>
                  <option value="gratitude">
                    üôè Gratitude: "Find joy in the little things"
                  </option>
                </select>
              </div>

              <div class="form-group">
                <label for="tags">Tags (comma-separated)</label>
                <input
                  type="text"
                  id="tags"
                  placeholder="work, family, goals, reflection..."
                />
              </div>

              <button type="submit" class="btn">
                <img
                  src="../assets/Butterfly5.png"
                  alt=""
                  class="pixel-butterfly-icon inline small"
                  aria-hidden="true"
                />
                Save Entry
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                onclick="clearForm()"
              >
                Clear
              </button>
            </form>
          </div>

          <div class="entries-list">
            <div class="search-filter">
              <input
                type="text"
                id="searchEntries"
                placeholder="Search entries..."
              />
              <select id="moodFilter">
                <option value="">All Moods</option>
                <option value="happy">Happy</option>
                <option value="excited">Excited</option>
                <option value="grateful">Grateful</option>
                <option value="calm">Calm</option>
                <option value="thinking">Thinking</option>
                <option value="tired">Tired</option>
                <option value="anxious">Anxious</option>
                <option value="sad">Sad</option>
                <option value="angry">Angry</option>
              </select>
            </div>

            <h3>üìñ Your Butterfly Journey</h3>
            <div id="entriesContainer">
              <p style="text-align: center; color: #6c757d; font-style: italic">
                No entries yet. Start your journey by writing your first
                butterfly thought above!
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      class ButterflyJournal {
        constructor() {
          this.entries =
            JSON.parse(localStorage.getItem("butterflyJournalEntries")) || [];
          this.currentMood = null;
          this.init();
        }

        init() {
          this.setupEventListeners();
          this.loadEntries();
          this.updateStats();
        }

        setupEventListeners() {
          document.querySelectorAll(".mood-btn").forEach((btn) => {
            btn.addEventListener("click", (e) => {
              document
                .querySelectorAll(".mood-btn")
                .forEach((b) => b.classList.remove("active"));
              e.currentTarget.classList.add("active");
              this.currentMood = e.currentTarget.dataset.mood;
            });
          });

          document
            .getElementById("journalForm")
            .addEventListener("submit", (e) => {
              e.preventDefault();
              this.saveEntry();
            });

          document
            .getElementById("searchEntries")
            .addEventListener("input", () => this.filterEntries());
          document
            .getElementById("moodFilter")
            .addEventListener("change", () => this.filterEntries());
        }

        saveEntry() {
          const title = document.getElementById("entryTitle").value.trim();
          const content = document.getElementById("entryContent").value.trim();
          const butterflyThought =
            document.getElementById("butterflyThought").value;
          const tags = document.getElementById("tags").value.trim();

          if (!content) {
            alert("Please write your thoughts before saving.");
            return;
          }

          if (!this.currentMood) {
            alert("Please select your mood for today.");
            return;
          }

          const entry = {
            id: Date.now(),
            date: new Date().toISOString(),
            title: title || "Untitled Entry",
            content,
            mood: this.currentMood,
            butterflyThought,
            tags: tags ? tags.split(",").map((tag) => tag.trim()) : [],
            timestamp: Date.now(),
          };

          this.entries.unshift(entry);
          this.saveToStorage();
          this.loadEntries();
          this.updateStats();
          this.clearForm();
          this.showNotification(
            "Your butterfly thought has been saved!",
            "success"
          );
        }

        loadEntries() {
          const container = document.getElementById("entriesContainer");
          const filteredEntries = this.getFilteredEntries();

          if (filteredEntries.length === 0) {
            container.innerHTML = `
              <p style="text-align: center; color: #6c757d; font-style: italic;">
                ${
                  this.entries.length === 0
                    ? "No entries yet. Start your journey by writing your first butterfly thought above!"
                    : "No entries match your search criteria."
                }
              </p>
            `;
            return;
          }

          container.innerHTML = filteredEntries
            .map((entry) => this.createEntryCard(entry))
            .join("");
        }

        getFilteredEntries() {
          const searchTerm = document
            .getElementById("searchEntries")
            .value.toLowerCase();
          const moodFilter = document.getElementById("moodFilter").value;

          return this.entries.filter((entry) => {
            const matchesSearch =
              !searchTerm ||
              entry.title.toLowerCase().includes(searchTerm) ||
              entry.content.toLowerCase().includes(searchTerm) ||
              entry.tags.some((tag) => tag.toLowerCase().includes(searchTerm));

            const matchesMood = !moodFilter || entry.mood === moodFilter;

            return matchesSearch && matchesMood;
          });
        }

        filterEntries() {
          this.loadEntries();
        }

        createEntryCard(entry) {
          const date = new Date(entry.date);
          const dateStr = date.toLocaleDateString();
          const timeStr = date.toLocaleTimeString([], {
            hour: "2-digit",
            minute: "2-digit",
          });

          const moodEmojis = {
            happy: "üòä",
            excited: "ü§ó",
            grateful: "üôè",
            calm: "üòå",
            thinking: "ü§î",
            tired: "üò¥",
            anxious: "üò∞",
            sad: "üò¢",
            angry: "üò†",
          };

          const butterflyThoughts = {
            transformation: "Transformation",
            patience: "üå± Patience",
            resilience: "üí™ Resilience",
            hope: "üåü Hope",
            selflove: "‚ù§Ô∏è Self-Love",
            courage: "ü¶Å Courage",
            gratitude: "üôè Gratitude",
          };

          return `
            <div class="entry-card">
              <div class="entry-header">
                <div class="entry-date">${dateStr} at ${timeStr}</div>
                <div class="entry-mood" title="${entry.mood}">${
            moodEmojis[entry.mood]
          }</div>
              </div>
              <div class="entry-title">${entry.title}</div>
              <div class="entry-content">${entry.content}</div>
              ${
                entry.butterflyThought
                  ? `<div class="butterfly-thought">
                      <img src="../assets/Butterfly6.png" alt="" class="pixel-butterfly-icon small" aria-hidden="true" />
                      ${butterflyThoughts[entry.butterflyThought]}
                    </div>`
                  : ""
              }
              ${
                entry.tags.length > 0
                  ? `<div class="entry-tags">${entry.tags
                      .map((tag) => `<span class="tag">${tag}</span>`)
                      .join("")}</div>`
                  : ""
              }
              <div style="margin-top: 10px;">
                <button class="btn" style="padding: 6px 12px; font-size: 0.9rem;" onclick="journal.editEntry(${
                  entry.id
                })">
                  Edit
                </button>
                <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.9rem;" onclick="journal.deleteEntry(${
                  entry.id
                })">
                  Delete
                </button>
              </div>
            </div>
          `;
        }

        updateStats() {
          const totalEntries = this.entries.length;
          const currentStreak = this.calculateStreak();
          const commonMood = this.getMostCommonMood();
          const monthEntries = this.getThisMonthEntries();

          document.getElementById("totalEntries").textContent = totalEntries;
          document.getElementById("currentStreak").textContent =
            currentStreak === 0
              ? "No streak"
              : `${currentStreak} day${currentStreak > 1 ? "s" : ""}`;
          document.getElementById("commonMood").textContent = commonMood || "-";
          document.getElementById(
            "monthEntries"
          ).textContent = `${monthEntries} entr${
            monthEntries === 1 ? "y" : "ies"
          }`;
        }

        calculateStreak() {
          if (this.entries.length === 0) return 0;

          const today = new Date();
          const dates = this.entries.map((entry) =>
            new Date(entry.date).toDateString()
          );
          const uniqueDates = [...new Set(dates)].sort(
            (a, b) => new Date(b) - new Date(a)
          );

          let streak = 0;
          for (let i = 0; i < uniqueDates.length; i++) {
            const entryDate = new Date(uniqueDates[i]);
            const expectedDate = new Date(today);
            expectedDate.setDate(expectedDate.getDate() - i);

            if (entryDate.toDateString() === expectedDate.toDateString()) {
              streak++;
            } else {
              break;
            }
          }

          return streak;
        }

        getMostCommonMood() {
          if (this.entries.length === 0) return null;

          const counts = {};
          this.entries.forEach((entry) => {
            counts[entry.mood] = (counts[entry.mood] || 0) + 1;
          });

          const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
          return sorted.length > 0 ? sorted[0][0] : null;
        }

        getThisMonthEntries() {
          if (this.entries.length === 0) return 0;

          const now = new Date();
          const month = now.getMonth();
          const year = now.getFullYear();

          return this.entries.filter((entry) => {
            const entryDate = new Date(entry.date);
            return (
              entryDate.getMonth() === month && entryDate.getFullYear() === year
            );
          }).length;
        }

        editEntry(id) {
          const entry = this.entries.find((item) => item.id === id);
          if (!entry) return;

          document.getElementById("entryTitle").value = entry.title;
          document.getElementById("entryContent").value = entry.content;
          document.getElementById("butterflyThought").value =
            entry.butterflyThought;
          document.getElementById("tags").value = entry.tags.join(", ");

          this.currentMood = entry.mood;
          document
            .querySelectorAll(".mood-btn")
            .forEach((btn) => btn.classList.remove("active"));
          const activeBtn = document.querySelector(
            `.mood-btn[data-mood="${entry.mood}"]`
          );
          if (activeBtn) activeBtn.classList.add("active");

          this.deleteEntry(id, { silent: true });
          this.showNotification("‚úèÔ∏è Editing mode activated.", "info");
        }

        deleteEntry(id, options = {}) {
          this.entries = this.entries.filter((entry) => entry.id !== id);
          this.saveToStorage();
          this.loadEntries();
          this.updateStats();

          if (!options.silent) {
            this.showNotification("üóëÔ∏è Entry removed.", "warning");
          }
        }

        saveToStorage() {
          localStorage.setItem(
            "butterflyJournalEntries",
            JSON.stringify(this.entries)
          );
        }

        clearForm() {
          document.getElementById("journalForm").reset();
          this.currentMood = null;
          document
            .querySelectorAll(".mood-btn")
            .forEach((btn) => btn.classList.remove("active"));
        }

        createPixelButterflyIcon(size = 28) {
          const icon = document.createElement("img");
          icon.src = "../assets/Butterfly7.png";
          icon.alt = "";
          icon.setAttribute("aria-hidden", "true");
          icon.style.width = `${size}px`;
          icon.style.height = `${size}px`;
          icon.style.imageRendering = "pixelated";
          return icon;
        }

        showNotification(message, type) {
          const existing = document.getElementById("journalNotification");
          if (existing) existing.remove();

          const notification = document.createElement("div");
          notification.id = "journalNotification";
          notification.style.position = "fixed";
          notification.style.bottom = "20px";
          notification.style.right = "20px";
          notification.style.padding = "12px 20px";
          notification.style.borderRadius = "25px";
          notification.style.color = "#fff";
          notification.style.zIndex = "1000";
          notification.style.boxShadow = "0 5px 15px rgba(0,0,0,0.2)";
          notification.style.display = "flex";
          notification.style.alignItems = "center";
          notification.style.gap = "10px";

          const colors = {
            success: "#6fcf97",
            info: "#56ccf2",
            warning: "#f2994a",
          };

          notification.style.background = colors[type] || "#8b5a8c";
          notification.appendChild(this.createPixelButterflyIcon(26));
          const textNode = document.createElement("span");
          textNode.textContent = message;
          notification.appendChild(textNode);
          document.body.appendChild(notification);

          setTimeout(() => {
            notification.style.opacity = "0";
            notification.style.transition = "opacity 0.3s ease";
            setTimeout(() => notification.remove(), 300);
          }, 2000);
        }
      }

      const journal = new ButterflyJournal();

      function clearForm() {
        journal.clearForm();
      }
    </script>
  </body>
</html>
