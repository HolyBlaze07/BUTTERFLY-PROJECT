<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Glowing Blue Butterfly</title>
    <link
      rel="icon"
      type="image/png"
      href="assets/butterfly.png"
      alt="butterfly icon"
    />
    <!-- Butterfly Theme System -->
    <script src="js/butterfly-theme.js"></script>
    <link rel="stylesheet" href="css/theme-selector.css" />
    <script src="js/theme-selector.js" defer></script>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/game.css" />
    <link rel="stylesheet" href="css/seasonal.css" />
    <link rel="stylesheet" href="css/challenges-preview.css" />
  </head>
  <body>
    <!-- Display Mode -->
    <div id="displayMode" class="mode-section active">
      <!-- Mode Toggle Button -->
      <button id="modeToggle" class="mode-toggle">Play Game</button>

      <!-- Options Button -->
      <button class="options-btn" onclick="openOptionsModal()" title="Options">
        Options
      </button>

      <button class="hub-button" onclick="window.location.href='hub.html'">
        <img
          src="assets/butterfly.png"
          alt="butterfly"
          class="hub-button-icon"
        />
        Back to Hub
      </button>

      <div class="stars" id="stars"></div>

      <h1 class="title">Glowing Blue Butterfly</h1>

      <div class="butterfly-container">
        <div class="butterfly">
          <!-- Wings -->
          <div class="wing wing-left-upper">
            <div class="wing-pattern pattern-1"></div>
          </div>
          <div class="wing wing-left-lower">
            <div class="wing-pattern pattern-2"></div>
          </div>
          <div class="wing wing-right-upper">
            <div class="wing-pattern pattern-3"></div>
          </div>
          <div class="wing wing-right-lower"></div>

          <!-- Body -->
          <div class="body"></div>

          <!-- Antennae -->
          <div class="antennae">
            <div class="antenna antenna-left"></div>
            <div class="antenna antenna-right"></div>
          </div>
        </div>
      </div>

      <!-- Challenges Container -->
      <div class="challenges-preview-container">
        <!-- Daily Challenges Preview Panel (Trigger) -->
        <div
          class="daily-challenges-panel"
          onclick="openDailyChallengesModal()"
        >
          <div class="challenges-title">üóìÔ∏è Daily Challenges</div>
        </div>

        <!-- Seasonal Events Preview Panel (Trigger) -->
        <div class="seasonal-challenges-panel" onclick="openSeasonalModal()">
          <div class="seasonal-title">üéâ Seasonal Event</div>
        </div>
      </div>
    </div>

    <!-- Game Mode -->
    <div id="gameMode" class="mode-section">
      <div class="game-container">
        <div class="ui-panel">
          <div class="score-display">Score: <span id="score">0</span></div>
          <div class="level-display">Level: <span id="level">1</span></div>
          <div class="time-display">Time: <span id="time">60</span>s</div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div>Combo: <span id="combo">0</span>x</div>
          <div>Butterflies: <span id="butterflyCount">0</span></div>
        </div>

        <!-- Game Control Buttons -->
        <div class="game-control-buttons">
          <button
            class="restart-game-btn"
            onclick="restartGame()"
            title="Restart Game"
          >
            üîÑ Restart
          </button>
          <button class="exit-game-btn" onclick="exitGame()" title="Exit Game">
            ‚úñ Exit
          </button>
        </div>

        <!-- Worldwide Records Panel -->
        <div class="records-panel">
          <div class="records-title">
            üèÜ Worldwide Records
            <button
              class="panel-toggle-btn"
              onclick="togglePanel('records')"
              title="Minimize"
            >
              ‚àí
            </button>
          </div>
          <div class="records-content">
            <div id="worldwideRecords">
              <div class="record-item">
                <span class="record-rank">1</span>
                <span class="record-name">Loading...</span>
                <span class="record-score">---</span>
              </div>
            </div>

            <div class="your-record" id="yourRecord" style="display: none">
              <div
                style="color: #00d4ff; font-weight: bold; margin-bottom: 5px"
              >
                Your Record
              </div>
              <div class="record-item">
                <span class="record-rank" id="yourRank">-</span>
                <span class="record-name" id="yourName">Player</span>
                <span class="record-score" id="yourScore">0</span>
              </div>
            </div>

            <div class="score-submit-row">
              <div class="name-field-wrapper">
                <input
                  type="text"
                  class="name-input"
                  id="playerName"
                  placeholder="Enter your name"
                  maxlength="20"
                />
                <div id="playerNameDisplay" class="name-display" hidden></div>
              </div>
              <button class="submit-score-btn" onclick="submitScore()">
                Submit Score
              </button>
            </div>

            <div class="achievements">
              <div style="color: #ffe66d; font-size: 14px; margin-bottom: 10px">
                üèÖ Achievements
              </div>
              <div id="achievementsList">
                <div class="achievement" id="ach-first-catch">
                  <div class="achievement-icon">ü¶ã</div>
                  <div class="achievement-text">First Catch</div>
                </div>
                <div class="achievement" id="ach-combo-5">
                  <div class="achievement-icon">‚ö°</div>
                  <div class="achievement-text">5x Combo</div>
                </div>
                <div class="achievement" id="ach-level-5">
                  <div class="achievement-icon">üåü</div>
                  <div class="achievement-text">Level 5</div>
                </div>
                <div class="achievement" id="ach-score-500">
                  <div class="achievement-icon">üíé</div>
                  <div class="achievement-text">500 Points</div>
                </div>
              </div>
            </div>

            <div class="stats-display">
              <div style="color: #88d8c3; font-size: 14px; margin-bottom: 8px">
                <img
                  src="assets/Butterfly12.png"
                  style="
                    width: 20px;
                    vertical-align: middle;
                    image-rendering: pixelated;
                  "
                />
                Your Stats
              </div>
              <div class="stat-item">
                <span>Games Played:</span>
                <span class="stat-value" id="gamesPlayed">0</span>
              </div>
              <div class="stat-item">
                <span>Total Score:</span>
                <span class="stat-value" id="totalScore">0</span>
              </div>
              <div class="stat-item">
                <span>Best Combo:</span>
                <span class="stat-value" id="bestCombo">0</span>
              </div>
              <div class="stat-item">
                <span>Butterflies Caught:</span>
                <span class="stat-value" id="totalCaught">0</span>
              </div>
            </div>
          </div>

          <button class="view-leaderboard-btn" onclick="showLeaderboard()">
            View Leaderboard
          </button>
        </div>

        <!-- Hidden elements for data sync -->
        <div style="display: none">
          <div id="dailyChallenges"></div>
          <div id="streakNumber"></div>
          <div id="timerCountdown"></div>
          <div id="weekDays"></div>
          <div id="seasonalChallengesList"></div>
          <div id="seasonalTimer"></div>
          <div id="seasonalCollectionGrid"></div>
        </div>

        <div id="butterflyContainer"></div>

        <div class="game-over" id="gameOver">
          <button class="close-modal-btn" onclick="closeGameOverModal(event)">
            √ó
          </button>
          <div class="game-over-butterfly">
            <div class="butterfly-container-modal">
              <div class="butterfly">
                <!-- Wings -->
                <div class="wing wing-left-upper">
                  <div class="wing-pattern pattern-1"></div>
                </div>
                <div class="wing wing-left-lower">
                  <div class="wing-pattern pattern-2"></div>
                </div>
                <div class="wing wing-right-upper">
                  <div class="wing-pattern pattern-3"></div>
                </div>
                <div class="wing wing-right-lower"></div>

                <!-- Body -->
                <div class="body"></div>

                <!-- Antennae -->
                <div class="antennae">
                  <div class="antenna antenna-left"></div>
                  <div class="antenna antenna-right"></div>
                </div>
              </div>
            </div>
          </div>
          <h2>Game Over!</h2>
          <p>Final Score: <span id="finalScore">0</span></p>
          <p>Level Reached: <span id="finalLevel">1</span></p>
          <p>Butterflies Caught: <span id="caughtCount">0</span></p>
          <p>Best Combo: <span id="finalCombo">0</span>x</p>
          <button class="restart-btn" onclick="restartGame()">
            Play Again
          </button>
          <button class="restart-btn" onclick="viewDisplayFromGameOver()">
            Exit Game
          </button>
        </div>

        <div class="combo-display" id="comboDisplay"></div>
      </div>
    </div>

    <script src="js/index.js"></script>
    <script src="js/game.js"></script>
    <script src="js/leaderboard.js"></script>
    <script src="js/daily-challenges.js"></script>
    <script src="js/seasonal-challenges.js"></script>
    <script src="js/mode-toggle.js"></script>
    <script>
      // Initialize preview panels after everything loads
      function syncPreviewPanels() {
        // Sync daily challenges preview
        setTimeout(() => {
          const mainContainer = document.getElementById("dailyChallenges");
          const previewContainer = document.getElementById(
            "dailyChallengesPreview"
          );
          if (mainContainer && previewContainer) {
            previewContainer.innerHTML = mainContainer.innerHTML;
          }

          // Sync streak display
          const mainStreak = document.getElementById("streakNumber");
          const previewStreak = document.getElementById("streakNumberPreview");
          if (mainStreak && previewStreak) {
            previewStreak.textContent = mainStreak.textContent;
          }

          // Sync timer
          const mainTimer = document.getElementById("timerCountdown");
          const previewTimer = document.getElementById("timerCountdownPreview");
          if (mainTimer && previewTimer) {
            previewTimer.textContent = mainTimer.textContent;
          }

          // Sync weekly progress
          const mainWeekDays = document.getElementById("weekDays");
          const previewWeekDays = document.getElementById("weekDaysPreview");
          if (mainWeekDays && previewWeekDays) {
            previewWeekDays.innerHTML = mainWeekDays.innerHTML;
          }
        }, 500);

        // Sync seasonal challenges preview
        setTimeout(() => {
          if (
            window.seasonalSystem &&
            typeof window.seasonalSystem.getSeasonData === "function"
          ) {
            const seasonData = window.seasonalSystem.getSeasonData();

            if (seasonData) {
              // Update season info
              const nameEl = document.getElementById("seasonNamePreview");
              const endEl = document.getElementById("seasonEndPreview");
              const bannerEl = document.getElementById(
                "seasonalEventBannerPreview"
              );

              if (nameEl) nameEl.textContent = seasonData.name;
              if (endEl) {
                const end = seasonData.dates.end;
                const monthNames = [
                  "Jan",
                  "Feb",
                  "Mar",
                  "Apr",
                  "May",
                  "Jun",
                  "Jul",
                  "Aug",
                  "Sep",
                  "Oct",
                  "Nov",
                  "Dec",
                ];
                endEl.textContent = `Ends: ${monthNames[end.month - 1]} ${
                  end.day
                }`;
              }
              if (bannerEl)
                bannerEl.textContent = `ü¶ã ${seasonData.name} Event Active! ü¶ã`;

              // Copy seasonal challenges list
              const mainList = document.getElementById(
                "seasonalChallengesList"
              );
              const previewList = document.getElementById(
                "seasonalChallengesListPreview"
              );
              if (mainList && previewList) {
                previewList.innerHTML = mainList.innerHTML;
              }

              // Copy timer
              const mainSeasonTimer = document.getElementById("seasonalTimer");
              const previewSeasonTimer = document.getElementById(
                "seasonalTimerPreview"
              );
              if (mainSeasonTimer && previewSeasonTimer) {
                previewSeasonTimer.textContent = mainSeasonTimer.textContent;
              }

              // Copy collection grid
              const mainCollection = document.getElementById(
                "seasonalCollectionGrid"
              );
              const previewCollection = document.getElementById(
                "seasonalCollectionGridPreview"
              );
              if (mainCollection && previewCollection) {
                previewCollection.innerHTML = mainCollection.innerHTML;
              }
            }
          }
        }, 500);
      }

      // Sync timers every second
      setInterval(() => {
        const mainTimer = document.getElementById("timerCountdown");
        const previewTimer = document.getElementById("timerCountdownPreview");
        if (mainTimer && previewTimer) {
          previewTimer.textContent = mainTimer.textContent;
        }

        const mainSeasonTimer = document.getElementById("seasonalTimer");
        const previewSeasonTimer = document.getElementById(
          "seasonalTimerPreview"
        );
        if (mainSeasonTimer && previewSeasonTimer) {
          previewSeasonTimer.textContent = mainSeasonTimer.textContent;
        }
      }, 1000);

      // Initialize seasonal system on page load for preview modals
      document.addEventListener("DOMContentLoaded", function () {
        if (window.initSeasonalChallenges) {
          window.initSeasonalChallenges();
        }
      });

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", syncPreviewPanels);

      // Re-sync when returning to display mode
      window.addEventListener("modeChanged", syncPreviewPanels);

      // Add click handlers for expand/collapse panels
      document.addEventListener("DOMContentLoaded", function () {
        const dailyPanel = document.querySelector(
          "#displayMode .daily-challenges-panel"
        );
        const seasonalPanel = document.querySelector(
          "#displayMode .seasonal-challenges-panel"
        );

        if (dailyPanel) {
          dailyPanel.addEventListener("click", function (e) {
            // Don't toggle if clicking the minimize button
            if (e.target.classList.contains("panel-toggle-btn")) return;
            this.classList.toggle("expanded");
          });
        }

        if (seasonalPanel) {
          seasonalPanel.addEventListener("click", function (e) {
            // Don't toggle if clicking the minimize button
            if (e.target.classList.contains("panel-toggle-btn")) return;
            this.classList.toggle("expanded");
          });
        }
      });
    </script>

    <!-- Daily Challenges Modal (at body level for proper z-index) -->
    <div
      class="challenges-modal"
      id="dailyChallengesModal"
      onclick="closeDailyChallengesModal(event)"
    >
      <div class="modal-content" onclick="event.stopPropagation()">
        <button class="modal-close" onclick="closeDailyChallengesModal(event)">
          ‚úï
        </button>
        <div class="modal-header">
          <h2>üóìÔ∏è Daily Challenges</h2>
        </div>
        <div class="modal-body">
          <div class="challenges-content" id="challenges-preview-content">
            <div class="daily-streak" id="dailyStreakPreview">
              <div class="streak-number" id="streakNumberPreview">0</div>
              <div class="streak-text">Day Streak</div>
            </div>

            <div class="daily-timer">
              <div class="timer-label">New Challenges In</div>
              <div class="timer-countdown" id="timerCountdownPreview">
                23:59:59
              </div>
            </div>

            <div id="dailyChallengesPreview">
              <!-- Challenges will be populated here -->
            </div>

            <div class="weekly-progress">
              <div class="weekly-title">Weekly Progress</div>
              <div class="week-days" id="weekDaysPreview">
                <!-- Days will be populated here -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Seasonal Event Modal (at body level for proper z-index) -->
    <div
      class="challenges-modal"
      id="seasonalModal"
      onclick="closeSeasonalModal(event)"
    >
      <div class="modal-content" onclick="event.stopPropagation()">
        <button class="modal-close" onclick="closeSeasonalModal(event)">
          ‚úï
        </button>
        <div class="modal-header">
          <h2>üéâ Seasonal Event</h2>
        </div>
        <div class="modal-body">
          <div class="challenges-content" id="seasonal-preview-content">
            <div class="season-info">
              <div class="season-name" id="seasonNamePreview">Loading...</div>
              <div class="season-end" id="seasonEndPreview">...</div>
            </div>

            <div class="seasonal-event-banner" id="seasonalEventBannerPreview">
              ü¶ã Event Active! ü¶ã
            </div>

            <div class="seasonal-timer">
              <div class="timer-label">Event Ends In</div>
              <div class="timer-countdown" id="seasonalTimerPreview">...</div>
            </div>

            <div
              class="seasonal-challenges-list"
              id="seasonalChallengesListPreview"
            >
              <!-- Seasonal challenges will be populated here -->
            </div>

            <div class="seasonal-collection">
              <div class="collection-title">ü¶ã Collection</div>
              <div class="collection-grid" id="seasonalCollectionGridPreview">
                <!-- Collection items will be populated here -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Options Modal -->
    <div
      class="challenges-modal"
      id="optionsModal"
      onclick="closeOptionsModal(event)"
    >
      <div
        class="modal-content options-modal-content"
        onclick="event.stopPropagation()"
      >
        <button class="modal-close" onclick="closeOptionsModal(event)">
          ‚úï
        </button>
        <div class="modal-header">
          <h2>‚öôÔ∏è Options</h2>
        </div>
        <div class="modal-body">
          <div class="options-modal-body">
            <div class="option-item">
              <label class="option-label">
                <span class="option-text">üîä Music</span>
                <button
                  class="toggle-music-btn"
                  id="toggleMusicBtn"
                  onclick="toggleMusic()"
                >
                  <span id="musicStatus">üîä ON</span>
                </button>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
